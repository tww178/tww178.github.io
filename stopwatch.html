<html>
  <body>
    <input type="text" id="whatDidUDo" name="name" required minlength="4" maxlength="100" size="10" />
    <button>Save the time!!!</button>
    <ul></ul>
    
    <script>
      document.querySelector("button").onclick = () => {
        const theText = document.querySelector("#whatDidUDo").value; // Get input value
        let timeArray = [];

        if (localStorage.getItem("recordedTime")) {
          timeArray = JSON.parse(localStorage.getItem("recordedTime"));
        }

        const dateNow = Date.now();
        const timeEntry = { task: theText, time: dateNow }; // Store both task and timestamp
        timeArray.push(timeEntry);

        saveTheTime(timeEntry); // Send task + time

        localStorage.setItem("recordedTime", JSON.stringify(timeArray));

        const prettyTimes = timeArray
          .map(entry => {
            const myDate = new Date(entry.time);
            return `<li>${myDate.toISOString()} - ${entry.task}</li>`; // Display both timestamp and task
          })
          .join("\n");

        document.querySelector("ul").innerHTML = prettyTimes;
        console.log(timeArray); // Logs all saved entries
      };

      function saveTheTime(timeEntry) {
        console.log("saveTheTime", timeEntry);
        const myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");

        const raw = JSON.stringify(timeEntry);

        const requestOptions = {
          method: "POST",
          headers: myHeaders,
          body: raw,
          redirect: "follow",
        };

        fetch("https://280f6d0e-bec1-4ddd-bb06-5494ffc0e24a-00-3thfss8fd9z6p.worf.replit.dev/savethetime", requestOptions)
          .then((response) => response.text())
          .then((result) => console.log(result))
          .catch((error) => console.error(error));
      }
    </script>
  </body>
</html>
